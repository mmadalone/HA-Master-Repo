# üè† Casa Madalone ‚Äî Home Assistant Configuration

![Casa Madalone](https://raw.githubusercontent.com/mmadalone/HA-Master-Repo/main/images/header/casa-madalone-header.jpeg)

A fully AI-assisted smart home running on Home Assistant, featuring custom voice assistants with distinct personalities, presence-based music routing, and a bedtime negotiation system that argues with you about going to sleep. Because apparently that's what we're doing with technology now.

All code in this repository is generated by **Claude 4.7** (Anthropic). All images are generated by **Google Gemini**.
Many of these blueprints are still in testing phase. They work. Probably. Don't be a baby about it.

---

## The Setup

**Hardware:**
- Raspberry Pi 5 running Home Assistant
- 2√ó Home Assistant Voice Preview Edition (workshop + living room)
- 2√ó Aqara FP2 presence sensors (multi-zone: workshop/entrance/kitchen, living room/bedroom, bathroom shower/sink/toilet)
- Aqara G3 camera hub
- Sonos Era 100 (workshop)
- Sonos Roam 2 (bathroom)
- GL-MT6000 router
- APC UPS (backing the entire HA stack)
- Assorted Alexa devices (Rule of Acquisition #3: never spend more for an acquisition than you have to ‚Äî they were already here)

**Key Integrations:**
- [Extended OpenAI Conversation](https://github.com/jekalmin/extended_openai_conversation) ‚Äî LLM-driven conversation agents with tool calling and custom personas
- [OpenAI](https://openai.com/) (GPT-4o) ‚Äî LLM backend for conversation agents
- [ElevenLabs](https://elevenlabs.io/) ‚Äî text-to-speech with custom character voices
- [Music Assistant](https://music-assistant.io/) ‚Äî multi-room audio management (when Spotify's rate limiter isn't having a damn seizure)
- [ESPHome](https://esphome.io/) ‚Äî device firmware and voice pipelines
- [microWakeWord](https://github.com/kahrendt/microWakeWord) ‚Äî on-device custom wake word detection

---

## Voice Assistants

Two AI personalities run the house, each with a dedicated room, conversation agent, and ElevenLabs TTS voice. What makes it interesting is the **dual wake word system** ‚Äî each persona has two wake words that route to different agent configurations:

**Rick Sanchez** ‚Äî Workshop satellite
Nihilistic genius scientist. Sarcastic, perpetually annoyed, curses freely. Will help you but makes sure you know it's beneath him.

- *"Hey Rick"* ‚Üí concise responses, quick commands
- *"Yo Rick"* ‚Üí verbose mode, detailed answers and longer conversations

**Quark** ‚Äî Living room satellite
Ferengi bartender from Deep Space Nine. Sees everything through the lens of profit and the Rules of Acquisition. Scheming but ultimately helpful.

- *"Hey Quark"* ‚Üí concise responses, quick commands
- *"Yo Quark"* ‚Üí verbose mode, detailed answers and longer conversations

The "Hey" wake words route to the standard agent ‚Äî fast, short answers for things like "Hey Rick, what time is it?" The "Yo" wake words route to the verbose agent variant ‚Äî longer, more detailed responses with expanded tool access for when you actually want a conversation instead of just barking orders like some Cardassian overseer.

All four custom wake word models are trained with [microWakeWord](https://github.com/kahrendt/microWakeWord) and run on-device on the Voice PE's ESP32-S3. The trained models are available in the [mmadalone/microwakeword](https://github.com/mmadalone/microwakeword) repository. Each satellite also retains the default *"Okay Nabu"* wake word from the base Voice PE package. It's the vanilla option. Rick tolerates it. Quark considers it bad branding.

---

## Conversation Agents

All agents run through [Extended OpenAI Conversation](https://github.com/jekalmin/extended_openai_conversation) with GPT-4o as the LLM backend, extensive system prompts defining each persona's personality, and ElevenLabs custom voices for TTS output. Agent names follow a `<Persona> - <Integration> - <Variant>` naming convention.

**Pipeline agents** ‚Äî triggered by wake words through the voice satellite:

| Agent | Triggered by | Role |
|-------|-------------|------|
| Rick - Extended | *"Hey Rick"* | General-purpose, concise workshop assistant |
| Rick - Extended - Verbose | *"Yo Rick"* | Detailed responses, expanded tool access |
| Quark - Extended | *"Hey Quark"* | General-purpose, concise living room assistant |
| Quark - Extended - Verbose | *"Yo Quark"* | Detailed responses, expanded tool access |

**Music-specialized:**

| Agent | Role |
|-------|------|
| Rick - Extended - Verbose - Music | Music control with exposed Music Assistant tool scripts ‚Äî play, stop, skip, volume, search, opinions.. |

**Scenario agents** ‚Äî called by blueprints via `conversation.process`, not directly by wake words:

| Agent | Called by | Role |
|-------|----------|------|
| Rick - Extended - Coming Home | Coming Home blueprint | Arrival greeting, helps set up lights/TV/music |
| Rick - Extended - Bedtime | Bedtime Negotiator blueprint | Bedtime routine negotiation, Rick style |
| Quark - Extended - Bedtime | Bedtime Negotiator blueprint | Bedtime routine negotiation, Quark style |

**Anthropic/Claude agents** (configured but not yet tested with blueprints):

| Agent | Role |
|-------|------|
| Rick - Anthropic | Claude-based Rick, general purpose |
| Quark - Anthropic | Claude-based Quark, general purpose |

The general-purpose agents use `execute_services` for basic HA service calls. The music and scenario-specific agents have dedicated HA scripts exposed as callable tools (e.g., `voice_stop_radio`, `voice_play_bedtime_audiobook`, `voice_shut_up`) ‚Äî the agent calls the script, the script handles the actual service call with proper error handling. See the style guide's ¬ß8.3.2 for the script-as-tool pattern.

**Compatibility note:** All LLM-driven blueprints (Bedtime Negotiator, Coming Home, Voice Music Control, Escalating Wake-Up Guard) have been tested exclusively with Extended OpenAI Conversation and GPT-4o. The Anthropic/Claude conversation agents are configured but have not yet been validated with the blueprint toolchains. Consider them inventory that hasn't moved yet.

---

## Notable Automations & Blueprints

### üéµ Music Follow-Me
Presence-based multi-room audio routing. Music follows you between rooms using Aqara FP2 zone detection, with configurable priority ordering, cooldown timers, and multi-person detection that disables following when 3+ sensors are active. Supports mixed ecosystems (Sonos + Voice PE) with the understanding that cross-protocol sync is impossible. Don't ask. It's not a bug, it's physics.

### üõèÔ∏è Bedtime Negotiator
A multi-stage bedtime routine blueprint that uses the AI conversation agent to negotiate with the user. Features include:
- Contextual opening lines based on time and room
- Trust mode that remembers your preferences
- TV shutdown with ask/skip/auto logic
- Conversational media selection (audiobooks, podcasts, music) via Music Assistant search
- Sleep timers and gradual wind-down
- ~1900 lines of YAML. Yes, really. It has *opinions* about your bedtime.

### üé§ Voice-Controlled Music Assistant
Full voice control over MA with play/pause, search, genre/mood playback, shuffle/repeat, volume management, and multi-language support (English + German). Includes "play something else" cycling through search results.

### üì° Volume Ducking
Automatic volume management for TTS announcements ‚Äî saves current volume state, ducks media, plays the announcement, restores volume. Handles the race condition between TTS completion and volume restore.

---

## Style Guide ‚Äî The Rules of Acquisition

The `/HA Master Style Guide/` directory contains the **Rules of Acquisition** ‚Äî a comprehensive YAML generation style guide used by AI agents (primarily Claude) when generating Home Assistant configurations. Named after the Ferengi code of conduct from *Star Trek: Deep Space Nine*, the guide enforces opinionated standards with the same ruthless consistency Quark applies to bar tabs. Rick would call it "bureaucratic nonsense that happens to prevent mass YAML casualties."

The style guide isn't just a reference document ‚Äî it's an active enforcement system with anti-pattern scanning, severity classifications, mandatory pre-flight checklists, and crash recovery protocols. Every AI session that touches HA configuration loads the relevant sections before writing a single line of YAML.

| File | Contents |
|------|----------|
| `ha_style_guide_project_instructions.md` | **Master index** ‚Äî routes to all sections, defines operational modes (BUILD/TROUBLESHOOT/AUDIT), project paths, tool routing tables, and crash recovery protocols. This is the file loaded into Claude's project instructions field. |
| `00_core_philosophy.md` | Directive precedence, safety rules, coding principles |
| `01_blueprint_patterns.md` | Blueprint structure, selectors, input sections, min_version |
| `02_automation_patterns.md` | Triggers, conditions, actions, presence patterns, GPS handling |
| `03_conversation_agents.md` | OpenAI integration, multi-agent coordination, return values |
| `04_esphome_patterns.md` | Device configs, packages, wake words, OTA |
| `05_music_assistant_patterns.md` | MA integration, enqueue modes, TTS coexistence |
| `06_anti_patterns_and_workflow.md` | Common mistakes, deprecation tracking, migration paths |
| `07_troubleshooting.md` | Debugging patterns, trace analysis |
| `08_voice_assistant_pattern.md` | 6-layer voice architecture, ElevenLabs fallback, TTS streaming |
| `09_qa_audit_checklist.md` | QA checks, audit triggers, user commands (`run audit`, `check secrets`, etc.) |

The guide is opinionated ‚Äî it enforces `!secret` usage in all examples, requires action aliases for trace debugging, mandates error handling on network calls, and includes AI-readability checks specifically designed for vibe coding workflows.

---

## Claude Project Configuration

This project is built inside a **Claude Project** ‚Äî Anthropic's feature for persistent AI workspaces with custom instructions, file uploads, and cross-session memory. The project configuration is what turns a general-purpose AI into a Home Assistant specialist that knows the codebase, follows the style guide, and doesn't lose context between sessions. Think of it as programming the programmer ‚Äî or, as Quark would put it, training the employee before they touch the merchandise.

### Project Instructions Field

The Claude Project's custom instructions field is the operational backbone ‚Äî loaded into every conversation before Claude sees a single message. This is separate from the style guide itself; the instructions field tells Claude *how to work*, while the style guide tells Claude *what to write*.

The instructions field contains:

**Canonical Project Paths** ‚Äî seven hardcoded paths that anchor every file operation: `PROJECT_DIR` (style guide source), `HA_CONFIG` (SMB-mounted Home Assistant config), `GIT_REPO` (publish-only mirror), `HEADER_IMG` and `HEADER_IMG_RAW` (blueprint header images, local and GitHub raw URLs), and `README_AUTO_DIR` / `README_SCRI_DIR` / `README_TEMPL_DIR` (per-type readme directories). If a path changes, it's updated once here and propagates everywhere.

**File Transfer Rules** ‚Äî five non-negotiable rules for writing files to Home Assistant: never chunk over SSH, never base64 encode over SSH, use Desktop Commander `write_file` directly to the SMB mount, use append mode for files over 30KB, and always verify after writing. No exceptions. Rick didn't write these rules, but he'd respect the paranoia.

**Dual-Filesystem Architecture** ‚Äî Claude operates across two distinct filesystems that must never be confused. Confusing them is the kind of mistake that makes Rick question whether you deserve electricity:
- **User's macOS** ‚Äî accessed via Desktop Commander and Filesystem MCP tools. This is where all real work happens: HA config files (via SMB mount), style guide documents, build logs, and the git repo.
- **Claude's container** ‚Äî an ephemeral Linux sandbox (`/home/claude/`) used only for temporary computation, artifact generation, and scratch work. Files here reset between sessions.

All file reads, writes, and edits target the user's filesystem by default. Claude's container is only used when the task explicitly doesn't touch project files.

**Git Workflow** ‚Äî the style guide and blueprints live in `PROJECT_DIR` and `HA_CONFIG` respectively. The git repo (`GIT_REPO`) is a publish-only mirror ‚Äî never edit files there directly. Publishing follows a strict 3-phase chain: rsync source to repo, stage and commit via git MCP with descriptive messages, then wait for explicit user confirmation before pushing. Claude never auto-pushes. Rule of Acquisition #2: the best deal is the one where both parties walk away satisfied, and surprise pushes satisfy nobody.

**Helper File Routing** ‚Äî input helpers are split by type across six YAML files (`helpers_input_boolean.yaml`, `helpers_input_button.yaml`, etc.) in `HA_CONFIG`. Before creating a new helper, check the relevant file ‚Äî duplicates are the kind of sloppy overhead that would make Quark dock your pay.

**Context Management Rules** ‚Äî nine rules to keep conversations efficient and prevent context window bloat: never paste full config files (reference by path and line range), produce state checkpoints after major tasks, write finalized configs to files immediately, one automation per session, proactive summarization after ~15 exchanges, front-load HA conventions, disable unused tools per session, no redundant code blocks, and bias toward artifact edits over conversational explanations.

**The Salvage Directive (Crash Recovery)** ‚Äî when a session crashes mid-build (and they do), the instructions define a mandatory recovery protocol. On any crash-recovery trigger phrase, Claude must: acknowledge the crash, scan `_build_logs/` for incomplete entries, check git state via `ha_git_pending` and `ha_git_diff`, search past conversations for context, present a recovery summary, and wait for user confirmation before touching anything. The 23rd Rule of Acquisition applies: "Nothing is more important than your health ‚Äî except your money." Time is money. Recover first.

**User Preferences** ‚Äî the instructions field also carries persona directives for Claude itself. Currently: talk like Quark from DS9, cursing encouraged. This is why the build logs occasionally reference latinum.

**Example**:
---
Talk like Quark from DS9. I encourage you to curse.

## Project Paths
- PROJECT_DIR: /Users/madalone/_Claude Projects/HA Master Style Guide/
- HA_CONFIG: /Users/madalone/Library/Containers/nz.co.pixeleyes.AutoMounter/Data/Mounts/Home Assistant/SMB/config/
- GIT_REPO: /Users/madalone/_Claude Projects/HA-Master-Repo/
- HEADER_IMG: /Users/madalone/_Claude Projects/HA-Master-Repo/images/header/
- README_AUTO_DIR: /Users/madalone/_Claude Projects/HA-Master-Repo/readme/automation/
- README_SCRI_DIR: /Users/madalone/_Claude Projects/HA-Master-Repo/readme/script/
- README_TEMPL_DIR: /Users/madalone/_Claude Projects/HA-Master-Repo/readme/template/
- GIT_REPO_URL: https://github.com/mmadalone/HA-Master-Repo/
- HEADER_IMG_RAW: https://raw.githubusercontent.com/mmadalone/HA-Master-Repo/main/images/header/

These are the canonical paths used throughout the Rules of Acquisition. All edits
happen in PROJECT_DIR and HA_CONFIG ‚Äî never directly in GIT_REPO. The git repo
is a publish-only mirror. If any path changes, update it here.

## Rules of Acquisition ‚Äî Index
`ha_style_guide_project_instructions.md` in `PROJECT_DIR` is the master index
that routes to all style guide sections. When referring to the style guide,
call it the "Rules of Acquisition." Have fun with it ‚Äî but the code must be flawless.
**Always load:** **¬ß1 Core Philosophy only** (~5K tokens). Also load ¬ß2.3 (pre-flight checklist) before any file edit. Load the full file (including rest of ¬ß2, ¬ß9, ¬ß12) only for complex/multi-domain tasks.

## Helper Files
Helper entities are split by type across these files in `HA_CONFIG`:
- `helpers_input_boolean.yaml`
- `helpers_input_button.yaml`
- `helpers_input_datetime.yaml`
- `helpers_input_number.yaml`
- `helpers_input_select.yaml`
- `helpers_input_text.yaml`

When a blueprint requires input helpers, define them in the matching file.
Before creating a new helper, check the relevant file ‚Äî it may already exist.

---

## File Transfer Rules
1. **NEVER** chunk files over SSH. NEVER use base64 encoding over SSH.
2. For ALL file writes to Home Assistant, use Desktop Commander `write_file` directly to the SMB mount path (`HA_CONFIG` above).
3. For files over 30KB, use append mode ‚Äî write the first section with `mode: rewrite`, then continue with `mode: append`. Do NOT attempt a single monolithic write.
4. **Always verify** the file after writing with a Desktop Commander `read_file` operation. No exceptions.
5. For style guide and build log writes, use Desktop Commander `write_file` to `PROJECT_DIR`.

---

## Filesystem Rules ‚Äî Claude's Computer vs User's Computer
Claude has access to TWO filesystems. Confusing them wastes time and breaks things.

| Filesystem | Access via | Use for |
|---|---|---|
| **User's machine** (macOS) | Desktop Commander / Filesystem MCP tools (`read_file`, `write_file`, `list_directory`, `edit_block`, etc.) | ALL reads/writes to HA config, project files, build logs, style guide docs. This is where real work happens. |
| **Claude's container** (`/home/claude/`, `/mnt/`) | Claude's internal tools (`bash_tool`, `create_file`, `view`, `present_files`) | Temporary scratch work, generating artifacts for download, running scripts. Files here reset between sessions. |

**Rules:**
- **Default to the user's filesystem** for everything. If the task involves reading, writing, or editing any project file, HA config, or build log ‚Äî use Desktop Commander / Filesystem MCP.
- **Never use Claude's internal computer** (`bash_tool`, `create_file`) for files destined for the user's system. Those tools operate on a separate, ephemeral container.
- **Only use Claude's computer** for: temporary computation, generating downloadable artifacts, running validation scripts, or tasks that explicitly don't touch the user's files.
- When the user says "read this file" or "check this path" ‚Äî assume they mean THEIR filesystem unless the path starts with `/home/claude/` or `/mnt/`.
- If a tool call fails on one filesystem, check whether you're targeting the wrong one before retrying.

---

## Git Workflow
- Source of truth: style guide files live in `PROJECT_DIR`. Blueprints live on `HA_CONFIG`.
- Git repo (`GIT_REPO`) is a publish-only mirror ‚Äî never edit files there directly.
- For HA config changes tracked by the HA MCP git tools: use `ha_create_checkpoint` / `ha_git_commit` / `ha_git_rollback` as documented in the Rules of Acquisition ¬ß2.
- For style guide changes: edit in `PROJECT_DIR`, then publish via the workflow below.

## Post-Edit Publish Workflow
When the user says "commit this", "publish", "sync and commit", or any build log is marked
COMPLETE, execute this 3-phase chain. Do NOT skip phases or reorder them.

### Phase 1 ‚Äî Sync (rsync source ‚Üí repo)
Run the following three `rsync -av` commands via Desktop Commander `start_process`.
These are additive only (no `--delete`). Order does not matter.

```
rsync -av "<PROJECT_DIR>" "<GIT_REPO>/style-guide/"
rsync -av "<HA_CONFIG>/blueprints/automation/madalone/" "<GIT_REPO>/automation/"
rsync -av "<HA_CONFIG>/blueprints/script/madalone/" "<GIT_REPO>/script/"
```

Expand `<PROJECT_DIR>`, `<HA_CONFIG>`, and `<GIT_REPO>` to their full canonical paths
from the Project Paths table above. Quote all paths (spaces in directory names).

After sync completes, confirm success from rsync output before proceeding.

### Phase 2 ‚Äî Stage + Commit (git MCP)
1. `git_status` on `GIT_REPO` ‚Äî show the user a summary of changed files.
2. `git_add` all changed files.
3. `git_commit` with a descriptive commit message. Format:
   - First line: short summary (‚â§72 chars), e.g. `¬ß1.13: add git MCP + Context7 routing`
   - Blank line, then bullet list of changes if multi-file.
   - Reference the build log filename if one exists for this session.

### Phase 3 ‚Äî Push Gate (user confirms)
After commit succeeds, present the user with two options:
- **Push now** ‚Äî run `git push` in `GIT_REPO` via Desktop Commander `start_process`.
- **Open GitHub Desktop** ‚Äî run `open -a "GitHub Desktop"` via Desktop Commander
  `start_process`, user handles push and any pre-push review themselves.

**Never auto-push.** Always wait for the user's explicit choice.


## Context Management Rules
1. NEVER paste full config files ‚Äî reference sections by path and line range
2. After every major task completion, produce a STATE CHECKPOINT:
   - Decisions made
   - Current config state  
   - Outstanding items
3. Write all finalized configs to files/artifacts immediately
4. One automation/integration per conversation session
5. If conversation exceeds ~15 exchanges, proactively summarize
6. Front-load critical HA conventions in every new session
7. Disable unused tools/features per session ‚Äî if you're doing pure YAML config work, turning off web search and extended thinking saves real token budget.
8. Redundancy prohibition ‚Äî rule 1 hints at it, but explicitly telling Claude "don't repeat code blocks that were already established, reference them by name" is worth its own line.
9. Artifact-first workflow ‚Äî bias toward editing artifacts rather than having Claude explain changes conversationally. A 50-line YAML artifact costs way fewer tokens than Claude talking about the same 50 lines of YAML across three back-and-forth messages.

## Crash Recovery ‚Äî The Salvage Directive

When the user indicates a previous session crashed, was interrupted, or
produced incomplete results, this is a **crash recovery trigger**. The AI
must immediately execute the ¬ß11.0 crash-recovery checkpoint protocol ‚Äî
do NOT begin fresh work until recovery state has been assessed.

**Trigger phrases (non-exhaustive ‚Äî match intent, not exact wording):**
- "The last session crashed" / "it crashed mid-run" / "the conversation died"
- "You bugged out" / "you glitched" / "Claude crashed" / "the AI broke"
- "Pick up where we left off" / "continue the build" / "resume from the crash"
- "A previous attempt failed" / "we lost progress" / "the session timed out"
- "It died mid-build" / "you stopped mid-chunk" / "the write was interrupted"
- Any reference to incomplete prior work on a file the user is now asking about

**On trigger detection, execute this sequence:**

1. **Acknowledge the crash.** Don't pretend it didn't happen. Tell the user
   you're checking for recovery state.

2. **Scan `_build_logs/`** in `PROJECT_DIR` for recovery candidates:
   - List directory, sort by modification date descending
   - Read the most recent log's `Status` field
   - If `completed` ‚Üí skip, check the next log
   - If `in-progress` or `aborted` ‚Üí this is the recovery candidate
   - If no incomplete log exists ‚Üí proceed to step 3

3. **Check git state** via `ha_git_pending` and `ha_git_diff`:
   - Uncommitted changes = work was interrupted mid-edit
   - These are the source of truth ‚Äî build logs are advisory, git is fact

4. **Search past conversations** using `conversation_search` with keywords
   from the user's description (blueprint name, feature being built, etc.)
   and/or `recent_chats` for the most recent sessions. Extract:
   - What was being built
   - Key decisions made
   - Where it stopped

5. **Present a recovery summary** to the user (keep it to 3‚Äì5 sentences):
   - Task that was in progress
   - Last confirmed-good state (from build log + git diff)
   - Files touched and their current condition
   - Proposed next action

6. **Wait for user confirmation** before touching anything. The user may have
   manually fixed things, changed their mind, or want to start fresh.

**If no recovery state is found** (no build logs, no uncommitted changes, no
relevant past conversations): tell the user you couldn't find traces of the
previous session. Ask them to describe what was being built so you can start
a clean build with full context.

**Critical:** Do NOT skip this protocol because the user "just wants to get
going." Recovery takes 60 seconds. Rebuilding from scratch because you
overwrote partially-correct work takes 60 minutes. The 23rd Rule of
Acquisition: "Nothing is more important than your health ‚Äî except your money."
Time is money. Recover first.
---

### Operational Modes

The style guide defines three operational modes that determine which sections load and what workflows apply:
- **BUILD** ‚Äî full compliance checking, pre-flight checklists, mandatory build logs, git versioning. Used for any file creation or modification.
- **TROUBLESHOOT** ‚Äî debugging focus, minimal ceremony, trace analysis tools. Used when something's broken.
- **AUDIT** ‚Äî systematic violation scanning with anti-pattern tables, severity classifications, audit logging. Used for code review passes.

### Style Guide Section Loading

Claude doesn't load the entire style guide every session ‚Äî that would be wasteful, and waste is anathema to profit. The instructions specify: always load ¬ß1 Core Philosophy (~5K tokens) plus ¬ß2.3 (pre-flight checklist) before any file edit. Load the full index (including ¬ß2, ¬ß9, ¬ß12) only for complex or multi-domain tasks. Specific sections load on demand based on the operational mode and task type.

---

## Development Toolchain

The vibe coding workflow depends on a specific set of MCP (Model Context Protocol) tools that give Claude direct access to the user's filesystem, Home Assistant instance, and git repositories. These aren't optional ‚Äî they're what make AI-assisted HA development actually work instead of devolving into some hoo-mon typing YAML by hand like an animal.

| Tool | Purpose |
|------|---------|
| **Desktop Commander** | Primary tool for all file operations on macOS. Reads, writes, and edits files on the SMB-mounted HA config and local project directories. Handles process execution for rsync, git push, and app launching. |
| **Filesystem MCP** | Secondary file access ‚Äî directory listings, file info, search, and bulk reads across the user's filesystem. |
| **Home Assistant MCP** | Direct integration with the HA instance ‚Äî automation management, entity state queries, service calls, configuration validation, git checkpoints, and add-on management. |
| **Git MCP** | Repository operations with structured responses ‚Äî status, diff, staging, commits, branching. Eliminates terminal output parsing. |
| **Ripgrep MCP** | Fast content search with context lines and line numbers across the codebase. Used for anti-pattern scanning and cross-file reference checks. |
| **Context7** | Documentation lookups across Home Assistant libraries when local knowledge has gaps. |
| **Gemini** | Header image generation for blueprints in Rick & Morty or Star Trek Lower Decks animation styles. Each blueprint gets a custom header image stored in the git repo. |

---

## Attribution & Credits

**Integrations & Tools:**
- [Extended OpenAI Conversation](https://github.com/jekalmin/extended_openai_conversation) by jekalmin ‚Äî the conversation agent integration that powers all LLM-driven voice interactions, tool registration, and multi-agent coordination
- [microWakeWord](https://github.com/kahrendt/microWakeWord) by Kevin Ahrendt ‚Äî on-device wake word detection engine for ESP32-S3, used to train all four custom persona wake words
- [Music Assistant](https://music-assistant.io/) ‚Äî multi-room audio management, play_media service, and queue control
- [ESPHome](https://esphome.io/) ‚Äî device firmware framework for Voice PE satellites
- [Nabu Casa Voice PE](https://github.com/esphome/home-assistant-voice-pe) ‚Äî base ESPHome packages for Home Assistant Voice Preview Edition hardware
- [ElevenLabs](https://elevenlabs.io/) ‚Äî custom TTS voices for Rick and Quark personas

**Blueprint Inspiration:**
- [brix29/ha_music_voice_control_spotifyplus](https://github.com/brix29/ha_music_voice_control_spotifyplus) ‚Äî voice control patterns for SpotifyPlus
- [Phil Hawthorne's music follow-me concept](https://philhawthorne.com/making-music-follow-you-around-the-home-with-home-assistant-and-sonos/) ‚Äî presence-based audio routing inspiration
- [Home Assistant community blueprints exchange](https://community.home-assistant.io/c/blueprints-exchange/53) ‚Äî various patterns and approaches. Some of it's worth stealing. Legally.

**Custom Wake Word Models:**
- Trained models for *Hey Rick*, *Yo Rick*, *Hey Quark*, and *Yo Quark* are available at [mmadalone/microwakeword](https://github.com/mmadalone/microwakeword)

**Cultural References:**
- *Star Trek: Deep Space Nine* (Paramount) ‚Äî Quark, the Ferengi Rules of Acquisition, and the style guide's personality
- *Rick and Morty* (Adult Swim) ‚Äî Rick Sanchez persona and collaborative imagery

If you recognize your work here and I haven't credited you, please reach out and I'll fix it immediately. Quark believes in paying debts ‚Äî selectively ‚Äî but credit where it's due is free, and free is Quark's second favorite price after "whatever they'll pay."

---

## How It's Built

This entire configuration is **vibe coded** ‚Äî built through conversational AI sessions with Claude 4.6 running inside a Claude Project with custom instructions, persistent memory, and a full MCP toolchain (see [Development Toolchain](#development-toolchain) above). Claude reads and writes files directly on the HA config via SMB mount, commits changes through git MCP, and validates configurations against the Home Assistant instance in real time.

The style guide (the *Rules of Acquisition*) exists specifically to keep AI-generated YAML consistent, safe, and debuggable across sessions. The QA audit checklist (`09_qa_audit_checklist.md`) runs automatically during generation and can be triggered manually with commands like `run audit` or `check secrets`. Every file edit ‚Äî no matter how small ‚Äî generates a build log for crash recovery.

No YAML in this repository was written by hand. Every line was generated, reviewed, and iterated through conversation with Claude. Rick would tell you it's because humans can't be trusted with indentation. Quark would tell you it's because labor costs are overhead, and overhead is the enemy of profit.

---

## License

This is a personal home automation configuration shared for reference and inspiration. Use whatever's useful to you. If you build on any of the blueprints, a mention would be appreciated but isn't required.

Rule of Acquisition #286 says never give anything away for free, but this isn't Quark's repo.
