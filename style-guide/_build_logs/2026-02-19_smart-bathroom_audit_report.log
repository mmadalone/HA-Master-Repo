[SESSION] 2026-02-19 | type: audit | scope: smart-bathroom.yaml (quick-pass) | status: complete

[FINDING] AP-08 | ⚠️ WARNING | smart-bathroom.yaml | Actions block is ~262 lines (threshold: 200). Branch 3 (door opened + occupied → wait for exit) accounts for most of the complexity with nested if/then + choose + if/then reaching ~5-6 nesting levels (threshold: 4).

[INTERPRETATION] AP-08 on smart-bathroom.yaml — The 262-line actions block is borderline. The complexity is inherent to the problem domain (7 branches covering all combinations of door/motion/shower/helper states). Branch 3 is the deepest at ~5-6 levels due to sequential motion-wait → shower-wait logic with timeout handling at each stage. Refactoring into a separate script would reduce nesting but add indirection. Marking WARNING not ERROR because the logic is well-aliased and each nested block has clear purpose. User should decide if extraction is worth the trade-off.

[NOTE] Consistency observation (not an AP violation): Branch 6 light-off action lacks continue_on_error: true, while all other light-off/on actions in Branches 1, 3, 4, 7 have it. Branch 6 is a single-action branch so there's no subsequent step to protect, but for pattern consistency it could be added.

[NOTE] Duplicate trigger_variables + variables blocks (lines 158-165) — This is correct HA practice: template triggers need variables at evaluation time (trigger_variables), while actions need them at runtime (variables). Not a finding, just documenting the review.

[SUMMARY] 27 checks executed | 26 PASS | 1 FAIL (1 finding, ⚠️ WARNING) | 0 SKIP | 2 advisory notes
[ACTION] Findings ready for user review. Fixes require BUILD-mode escalation with build log.
