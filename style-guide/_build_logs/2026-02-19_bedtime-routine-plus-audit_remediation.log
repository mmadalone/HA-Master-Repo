# Build Log: bedtime_routine_plus.yaml — Audit Remediation
# Date: 2026-02-19
# Status: completed
# Blueprint: bedtime_routine_plus.yaml
# Version: 5.4.0 → 5.4.1

## Scope
Remediate findings from style guide compliance audit:
- C-1: Jinja2 scoping bug — curated_items never populated (namespace fix)
- C-2: Jinja2 scoping bug — movies genre filter never persists (namespace fix)
- M-1: WONTFIX — §① collapsed: false is intentional; corrected v5.4.0 changelog claim
- M-2: Manual trigger reset lacks continue_on_error
- L-1: logbook.log calls lack continue_on_error (8 instances)
- L-2: WONTFIX — architectural duplication, no blueprint-level fix available

## Target File
HA_CONFIG/blueprints/automation/madalone/bedtime_routine_plus.yaml

## Changes Applied
1. C-1: Replaced `{% set curated_items = [] %}` loop pattern with `namespace(items=[])` — curated content now persists after loop exit
2. C-2: Replaced `{% set movies = [] %}` loop pattern with `namespace(items=[])` — genre-filtered movies now persist after loop exit
3. M-1: Removed false claim "fixed §① collapsed: false → true" from v5.4.0 changelog — §① collapsed: false is intentional
4. M-2: Added `continue_on_error: true` to manual trigger boolean reset (input_boolean.turn_off)
5. L-1: Added `continue_on_error: true` to all 8 logbook.log action calls
6. Version bumped 5.4.0 → 5.4.1
7. Added v5.4.1 changelog entry

## Verification
- All 8 logbook.log calls confirmed with continue_on_error via ripgrep
- Both namespace patterns confirmed at lines 1832/1849 with proper outer variable assignment
- Manual trigger reset confirmed with continue_on_error at line 1160
- blueprint_version confirmed as "5.4.1"
