# =============================================================================
# Script: play_radio_station
# 
# Generic script that plays a radio station on the correct Music Assistant
# speaker based on the room parameter. Called from Alexa Routines via
# HA Cloud or Alexa Media Player integration.
#
# Usage: Call with variables { room: "bathroom", station: "klara" }
# =============================================================================

play_radio_station:
  alias: "Play Radio Station (Room-Aware)"
  description: >
    Plays a radio station via Music Assistant on the speaker mapped to the
    given room. Designed to be triggered by Alexa Routines per device.
  mode: parallel
  max: 5

  fields:
    room:
      description: "Target room identifier"
      required: true
      example: "bathroom"
      selector:
        select:
          options:
            - bathroom
            - living_room
            - workshop

    station:
      description: "Radio station identifier"
      required: true
      example: "klara"
      selector:
        select:
          options:
            - klara
            - stubru
            - radio1
            # Add more stations as needed

  variables:
    # =========================================================================
    # ROOM → MUSIC ASSISTANT PLAYER MAPPING
    # Replace these entity_ids with your actual MA speaker entities
    # =========================================================================
    room_player_map:
      bathroom: "media_player.ma_bathroom_speaker"
      living_room: "media_player.ma_living_room_speaker"
      workshop: "media_player.ma_workshop_speaker"

    # =========================================================================
    # STATION → MEDIA URI / CONTENT ID MAPPING
    # Use the media content IDs from your Music Assistant radio library
    # You can find these in MA → Library → Radio → click station → copy URI
    # =========================================================================
    station_map:
      klara: "media_item://radio/klara"
      stubru: "media_item://radio/stubru"
      radio1: "media_item://radio/radio1"
      # Add more stations as needed

    # Resolve the target player and station URI
    target_player: "{{ room_player_map.get(room, '') }}"
    media_uri: "{{ station_map.get(station, '') }}"

  sequence:
    # Validate inputs
    - condition: template
      value_template: "{{ target_player != '' and media_uri != '' }}"

    # Play the station on the target room's MA speaker
    - action: music_assistant.play_media
      target:
        entity_id: "{{ target_player }}"
      data:
        media_id: "{{ media_uri }}"
        media_type: "radio"
        enqueue: "replace"
